# 用户服务接口文档

## 1. 基础用户接口

### 1.1 登录接口
- **接口路径**: `/user/login`
- **请求方法**: `POST`
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | username | string | 是 | 用户名，3-20个字符，不含特殊字符 |
  | password | string | 是 | 密码，6-20个字符 |

- **响应参数**:
  ```json
  {
    "message": "登录成功"
  }
  ```
  | 参数名 | 类型 | 描述 |
  |--------|------|------|
  | message | string | 操作结果信息 |

- **错误响应**:
  ```json
  {
    "message": "用户名或密码不能为空"
  }
  ```
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 用户名或密码不能为空 | 参数验证失败 |
  | 401 | 用户不存在 | 用户名未注册 |
  | 401 | 账号已被禁用 | 用户账号状态异常 |
  | 401 | 密码错误 | 密码验证失败 |
  | 500 | 系统错误，请稍后重试 | 服务器内部错误 |

### 1.2 注册接口
- **接口路径**: `/user/register`
- **请求方法**: `POST`
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | username | string | 是 | 用户名，3-20个字符，不含特殊字符 |
  | password | string | 是 | 密码，6-20个字符 |
  | confirm_password | string | 是 | 确认密码，必须与密码一致 |

- **响应参数**:
  ```json
  {
    "message": "注册成功，请登录"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 用户名和密码不能为空 | 参数验证失败 |
  | 400 | 用户名长度应在3-20个字符之间 | 用户名格式错误 |
  | 400 | 密码长度应在6-20个字符之间 | 密码格式错误 |
  | 400 | 两次输入的密码不一致 | 密码确认失败 |
  | 400 | 用户名已存在 | 用户名已被注册 |
  | 500 | 注册失败，请重试 | 服务器内部错误 |

### 1.3 注销接口
- **接口路径**: `/user/logout`
- **请求方法**: `GET`
- **请求参数**: 无
- **响应**: 重定向到首页

## 2. 用户信息管理接口

### 2.1 个人信息页面
- **接口路径**: `/user/edit_profile`
- **请求方法**: `GET`
- **权限**: 需要登录
- **响应**: 返回个人信息页面

### 2.2 修改用户名
- **接口路径**: `/user/update_username`
- **请求方法**: `POST`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | new_username | string | 是 | 新用户名，3-20个字符，不含特殊字符 |

- **响应参数**:
  ```json
  {
    "message": "用户名修改成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 用户名不能为空 | 参数验证失败 |
  | 400 | 用户名包含非法字符 | 用户名格式错误 |
  | 400 | 用户名长度应在3-20个字符之间 | 用户名格式错误 |
  | 400 | 用户名已存在 | 用户名已被注册 |
  | 500 | 用户名修改失败 | 服务器内部错误 |

### 2.3 修改密码
- **接口路径**: `/user/update_password`
- **请求方法**: `POST`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | old_password | string | 是 | 原密码 |
  | current_password | string | 否 | 原密码（兼容字段） |
  | new_password | string | 是 | 新密码，6-20个字符 |
  | confirm_password | string | 是 | 确认新密码，必须与新密码一致 |

- **响应参数**:
  ```json
  {
    "message": "密码修改成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 原密码错误 | 原密码验证失败 |
  | 400 | 密码长度应在6-20个字符之间 | 新密码格式错误 |
  | 400 | 两次输入的密码不一致 | 密码确认失败 |
  | 500 | 密码修改失败 | 服务器内部错误 |

### 2.4 同时修改用户名和密码
- **接口路径**: `/user/update_account_info`
- **请求方法**: `POST`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | new_username | string | 是 | 新用户名，3-20个字符，不含特殊字符 |
  | current_password | string | 是 | 当前密码 |
  | new_password | string | 是 | 新密码，6-20个字符 |

- **响应参数**:
  ```json
  {
    "message": "账户信息修改成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 用户名不能为空 | 参数验证失败 |
  | 400 | 当前密码不能为空 | 参数验证失败 |
  | 400 | 新密码不能为空 | 参数验证失败 |
  | 400 | 当前密码错误 | 原密码验证失败 |
  | 400 | 用户名已存在 | 用户名已被注册 |
  | 500 | 账户信息修改失败 | 服务器内部错误 |

### 2.5 修改网易云用户ID
- **接口路径**: `/user/update_netease_user_id`
- **请求方法**: `POST`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | new_netease_user_id | integer | 否 | 网易云用户ID（可以为空） |

- **响应参数**:
  ```json
  {
    "message": "网易云用户ID修改成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 网易云用户ID格式错误，必须是整数 | 参数验证失败 |
  | 400 | 网易云用户ID超出有效范围 | 参数验证失败 |
  | 500 | 网易云用户ID修改失败 | 服务器内部错误 |

### 2.6 获取用户信息
- **接口路径**: `/user/get_user_info`
- **请求方法**: `GET`
- **权限**: 需要登录
- **响应参数**:
  ```json
  {
    "message": "获取用户信息成功",
    "data": {
      "id": 1,
      "username": "testuser",
      "netease_user_id": 123456,
      "status": 0,
      "is_admin": 0
    }
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 404 | 用户不存在 | 用户不存在 |
  | 500 | 系统错误，请稍后重试 | 服务器内部错误 |

## 3. 歌单管理接口

### 3.1 创建歌单
- **接口路径**: `/user/create_playlist`
- **请求方法**: `POST`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | name | string | 是 | 歌单名称，最多100个字符 |
  | cover_url | string | 否 | 歌单封面URL |
  | description | string | 否 | 歌单描述 |

- **响应参数**:
  ```json
  {
    "message": "歌单创建成功",
    "playlist_id": 1
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 歌单名称不能为空 | 参数验证失败 |
  | 400 | 歌单名称长度不能超过100个字符 | 参数验证失败 |
  | 400 | 歌单名称已存在 | 歌单名称已存在 |
  | 500 | 歌单创建失败 | 服务器内部错误 |

### 3.2 获取歌单列表
- **接口路径**: `/user/playlists`
- **请求方法**: `GET`
- **权限**: 需要登录
- **响应参数**:
  ```json
  {
    "playlists": [
      {
        "id": 1,
        "name": "我的歌单",
        "cover_url": "http://example.com/cover.jpg",
        "description": "我的第一个歌单",
        "create_time": "2023-01-01 10:00:00",
        "update_time": "2023-01-01 10:00:00",
        "song_count": 5
      }
    ],
    "total": 1
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 500 | 系统错误，请稍后重试 | 服务器内部错误 |

### 3.3 获取歌单详情
- **接口路径**: `/user/playlist/<playlist_id>`
- **请求方法**: `GET`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | playlist_id | integer | 是 | 歌单ID |

- **响应参数**:
  ```json
  {
    "playlist": {
      "id": 1,
      "name": "我的歌单",
      "cover_url": "http://example.com/cover.jpg",
      "description": "我的第一个歌单",
      "create_time": "2023-01-01 10:00:00",
      "update_time": "2023-01-01 10:00:00"
    },
    "songs": [
      {
        "song_id": 123456,
        "add_time": "2023-01-01 10:00:00",
        "name": "歌曲名称",
        "artist": "歌手名称",
        "cover_url": "http://example.com/song_cover.jpg",
        "album": "专辑名称"
      }
    ],
    "song_count": 1
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 404 | 歌单不存在或无权访问 | 歌单不存在或无权限访问 |
  | 500 | 系统错误，请稍后重试 | 服务器内部错误 |

### 3.4 添加歌曲到歌单
- **接口路径**: `/user/playlist/<playlist_id>/add_song`
- **请求方法**: `POST`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | playlist_id | integer | 是 | 歌单ID |
  | song_id | integer | 是 | 歌曲ID |

- **响应参数**:
  ```json
  {
    "message": "歌曲添加成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 歌曲ID不能为空 | 参数验证失败 |
  | 400 | 歌曲ID格式错误 | 参数验证失败 |
  | 404 | 歌单不存在或无权访问 | 歌单不存在或无权限访问 |
  | 400 | 歌曲已在歌单中 | 歌曲已存在于歌单 |
  | 500 | 歌曲添加失败 | 服务器内部错误 |

### 3.5 从歌单删除歌曲
- **接口路径**: `/user/playlist/<playlist_id>/remove_song/<song_id>`
- **请求方法**: `DELETE`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | playlist_id | integer | 是 | 歌单ID |
  | song_id | integer | 是 | 歌曲ID |

- **响应参数**:
  ```json
  {
    "message": "歌曲删除成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 404 | 歌单不存在或无权访问 | 歌单不存在或无权限访问 |
  | 404 | 歌曲不在歌单中 | 歌曲不在歌单中 |
  | 500 | 歌曲删除失败 | 服务器内部错误 |

### 3.6 更新歌单信息
- **接口路径**: `/user/playlist/<playlist_id>`
- **请求方法**: `PUT`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | playlist_id | integer | 是 | 歌单ID |
  | name | string | 否 | 歌单名称，最多100个字符 |
  | cover_url | string | 否 | 歌单封面URL |

- **响应参数**:
  ```json
  {
    "message": "歌单信息更新成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 请提供要更新的歌单名称或封面 | 参数验证失败 |
  | 400 | 歌单名称格式错误 | 参数验证失败 |
  | 400 | 歌单名称不能为空 | 参数验证失败 |
  | 400 | 歌单名称长度不能超过100个字符 | 参数验证失败 |
  | 404 | 歌单不存在或无权访问 | 歌单不存在或无权限访问 |
  | 500 | 歌单信息更新失败 | 服务器内部错误 |

### 3.7 删除歌单
- **接口路径**: `/user/playlist/<playlist_id>`
- **请求方法**: `DELETE`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | playlist_id | integer | 是 | 歌单ID |

- **响应参数**:
  ```json
  {
    "message": "歌单删除成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 404 | 歌单不存在或无权访问 | 歌单不存在或无权限访问 |
  | 500 | 歌单删除失败 | 服务器内部错误 |

## 4. 播放历史接口

### 4.1 保存播放历史
- **接口路径**: `/user/save_history`
- **请求方法**: `POST`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | song_id | integer | 是 | 歌曲ID |

- **响应参数**:
  ```json
  {
    "message": "播放历史保存成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 歌曲ID不能为空 | 参数验证失败 |
  | 400 | 歌曲ID格式错误 | 参数验证失败 |
  | 400 | 歌曲ID超出有效范围 | 参数验证失败 |
  | 500 | 播放历史保存失败 | 服务器内部错误 |

### 4.2 获取播放历史
- **接口路径**: `/user/get_history`
- **请求方法**: `GET`
- **权限**: 需要登录
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | page | integer | 否 | 页码，默认1 |
  | page_size | integer | 否 | 每页数量，默认10 |

- **响应参数**:
  ```json
  {
    "history": [
      {
        "song_id": 123456,
        "play_time": "2023-01-01 10:00:00",
        "name": "歌曲名称",
        "artist": "歌手名称",
        "cover_url": "http://example.com/song_cover.jpg",
        "album": "专辑名称"
      }
    ],
    "total": 1,
    "page": 1,
    "page_size": 10,
    "total_pages": 1,
    "has_details": true
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 500 | 系统错误，请稍后重试 | 服务器内部错误 |

## 5. 管理员接口

### 5.1 获取所有用户列表
- **接口路径**: `/user/admin/users`
- **请求方法**: `GET`
- **权限**: 需要管理员权限
- **响应参数**:
  ```json
  {
    "message": "获取用户列表成功",
    "data": [
      {
        "id": 1,
        "username": "testuser",
        "netease_user_id": 123456,
        "status": 0,
        "is_admin": 0,
        "create_time": "2023-01-01 10:00:00"
      }
    ]
  }
  ```

### 5.2 删除用户
- **接口路径**: `/user/admin/users/<target_user_id>`
- **请求方法**: `DELETE`
- **权限**: 需要管理员权限
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | target_user_id | integer | 是 | 目标用户ID |

- **响应参数**:
  ```json
  {
    "message": "删除用户成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 不能删除自己 | 不能删除当前登录的管理员 |
  | 404 | 用户不存在 | 用户不存在 |

### 5.3 封禁用户
- **接口路径**: `/user/admin/users/<target_user_id>/ban`
- **请求方法**: `PUT`
- **权限**: 需要管理员权限
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | target_user_id | integer | 是 | 目标用户ID |

- **响应参数**:
  ```json
  {
    "message": "封禁用户成功"
  }
  ```

### 5.4 解放用户
- **接口路径**: `/user/admin/users/<target_user_id>/unban`
- **请求方法**: `PUT`
- **权限**: 需要管理员权限
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | target_user_id | integer | 是 | 目标用户ID |

- **响应参数**:
  ```json
  {
    "message": "解放用户成功"
  }
  ```

### 5.5 设置用户为管理员
- **接口路径**: `/user/admin/users/<target_user_id>/set_admin`
- **请求方法**: `PUT`
- **权限**: 需要管理员权限
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | target_user_id | integer | 是 | 目标用户ID |

- **响应参数**:
  ```json
  {
    "message": "设置用户为管理员成功"
  }
  ```

### 5.6 修改用户信息
- **接口路径**: `/user/admin/users/<target_user_id>`
- **请求方法**: `PUT`
- **权限**: 需要管理员权限
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | target_user_id | integer | 是 | 目标用户ID |
  | username | string | 否 | 用户名 |
  | password | string | 否 | 密码 |
  | netease_user_id | integer | 否 | 网易云用户ID |

- **响应参数**:
  ```json
  {
    "message": "修改用户信息成功"
  }
  ```

- **错误响应**:
  | HTTP状态码 | 错误信息 | 描述 |
  |------------|----------|------|
  | 400 | 请至少提供一个需要修改的字段 | 参数验证失败 |
  | 400 | 用户名不能为空 | 参数验证失败 |
  | 400 | 密码不能为空 | 参数验证失败 |
  | 400 | 用户名已存在 | 用户名已被注册 |
  | 404 | 用户不存在 | 用户不存在 |

### 5.7 获取所有歌单
- **接口路径**: `/user/admin/playlists`
- **请求方法**: `GET`
- **权限**: 需要管理员权限
- **响应参数**:
  ```json
  {
    "playlists": [
      {
        "id": 1,
        "user_id": 1,
        "username": "testuser",
        "name": "我的歌单",
        "cover_url": "http://example.com/cover.jpg",
        "description": "我的第一个歌单",
        "create_time": "2023-01-01 10:00:00",
        "update_time": "2023-01-01 10:00:00",
        "song_count": 5
      }
    ],
    "total": 1
  }
  ```

### 5.8 获取用户歌单
- **接口路径**: `/user/admin/users/<user_id>/playlists`
- **请求方法**: `GET`
- **权限**: 需要管理员权限
- **请求参数**:
  | 参数名 | 类型 | 必填 | 描述 |
  |--------|------|------|------|
  | user_id | integer | 是 | 用户ID |

- **响应参数**:
  ```json
  {
    "user": {
      "id": 1,
      "username": "testuser"
    },
    "playlists": [
      {
        "id": 1,
        "user_id": 1,
        "username": "testuser",
        "name": "我的歌单",
        "cover_url": "http://example.com/cover.jpg",
        "description": "我的第一个歌单",
        "create_time": "2023-01-01 10:00:00",
        "update_time": "2023-01-01 10:00:00",
        "song_count": 5
      }
    ],
    "total": 1
  }
  ```

## 6. 通用错误码

| 错误码 | 描述 |
|--------|------|
| 400 | 参数验证失败 |
| 401 | 未登录或登录过期 |
| 403 | 无权限访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 7. 权限说明

- **需要登录**: 接口需要用户登录才能访问，未登录会返回401错误
- **需要管理员权限**: 接口需要管理员权限才能访问，普通用户会返回403错误