var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,i=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&n(e,l,t[l]);if(r)for(var l of r(t))o.call(t,l)&&n(e,l,t[l]);return e},s=(e,t,l)=>new Promise((r,a)=>{var o=e=>{try{i(l.next(e))}catch(t){a(t)}},n=e=>{try{i(l.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,n);i((l=l.apply(e,t)).next())});import{d as u,a as p,r as m,c as d,o as c,b3 as v,E as h,e as j,f,p as y,u as b,F as g,z as x,G as _,y as k,l as w,m as C,aC as O,n as E,$ as B,aQ as L}from"./index-DxSWhjl1.js";import{E as P}from"./el-card-CxrJQUwV.js";import{_ as A}from"./index-SZqK-YiV.js";import{u as M,_ as T}from"./useTableColumns-DRhLfddV.js";/* empty css                  */import{_ as R}from"./index-baS9l8Oy.js";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-IbCzS5fK.js";import{_ as $}from"./menu-dialog.vue_vue_type_script_setup_true_lang-CduIyy8n.js";import"./tree-select-DefJVcvz.js";import{a as S}from"./message-box-B9816q0a.js";/* empty css              *//* empty css                */import{E as I}from"./index-Bh_mQ9x7.js";import{E as U}from"./el-option-Cunb9zja.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                   */import"./el-empty-BI85Vzrg.js";import"./index-BdUhC8Rj.js";import"./index-BdOifhfF.js";import"./index-DpIcWAeA.js";import"./index-CD_r_rq4.js";import"./index-B5405CIA.js";import"./aria-Dle50h-X.js";import"./index-B4YNvkKg.js";import"./_initCloneObject-CnmkLFFW.js";import"./el-radio-g-Zqyaif.js";import"./event-BwRzfsZt.js";import"./castArray-CTnnYyy2.js";import"./debounce-Lel90vLM.js";import"./index-D0y5PuVQ.js";import"./index-BDfTIPIJ.js";import"./index-CRXlpzmM.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-dropdown-item-BQzRcAOp.js";import"./refs-Cw5r5QN8.js";import"./index.vue_vue_type_script_setup_true_lang-VvwPD4Pm.js";/* empty css                     */import"./el-row-BbFCgjqK.js";import"./el-col-ZA0CGZf_.js";import"./index-WiqLJQME.js";import"./index-Bn9cuIqS.js";import"./index-DrgPkUCe.js";import"./index-D-zLU9MD.js";import"./validator-Cq7xwYaP.js";import"./index-CFBlNhx4.js";/* empty css                  *//* empty css                   *//* empty css                        */import"./index-CJAV6PHc.js";import"./index-DqeJCCY1.js";import"./vnode-D3WqlgwN.js";import"./use-dialog-DNz0WzI-.js";import"./index-Boro3eJa.js";import"./token-DWNpOE8r.js";import"./index-DBG9R7L1.js";const V={class:"menu-page art-full-height"},F=u((K=i({},{name:"Menus"}),t(K,l({__name:"index",setup(e){const t=p(!1),l=p(!1),r=p(),a=p(!1),o=p("menu"),n=p(null),u=p(!1),F={name:"",route:""},K=m(i({},F)),Q=m(i({},F)),G=d(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"route",type:"input",props:{clearable:!0}}]);c(()=>{H()});const H=()=>s(null,null,function*(){t.value=!0;try{const e=yield v();q.value=e}catch(e){throw e instanceof Error?e:new Error("获取菜单失败")}finally{t.value=!1}}),J=e=>{var t,l,r,a,o;return(null==(t=e.meta)?void 0:t.isAuthButton)?"danger":(null==(l=e.children)?void 0:l.length)?"info":(null==(r=e.meta)?void 0:r.link)&&(null==(a=e.meta)?void 0:a.isIframe)?"success":e.path?"primary":(null==(o=e.meta)?void 0:o.link)?"warning":"info"},{columnChecks:N,columns:W}=M(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return O(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>B(U,{type:J(e)},()=>(e=>{var t,l,r,a,o;return(null==(t=e.meta)?void 0:t.isAuthButton)?"按钮":(null==(l=e.children)?void 0:l.length)?"目录":(null==(r=e.meta)?void 0:r.link)&&(null==(a=e.meta)?void 0:a.isIframe)?"内嵌":e.path?"菜单":(null==(o=e.meta)?void 0:o.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,l;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(l=e.meta)?void 0:l.link)||e.path||""}},{prop:"meta.authList",label:"权限标识",formatter:e=>{var t,l,r,a;return(null==(t=e.meta)?void 0:t.isAuthButton)?(null==(l=e.meta)?void 0:l.authMark)||"":(null==(a=null==(r=e.meta)?void 0:r.authList)?void 0:a.length)?`${e.meta.authList.length} 个权限标识`:""}},{prop:"date",label:"编辑时间",formatter:()=>"2022-3-12 12:00:00"},{prop:"status",label:"状态",formatter:()=>B(U,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{var t;const l={style:"text-align: right"};return(null==(t=e.meta)?void 0:t.isAuthButton)?B("div",l,[B(D,{type:"edit",onClick:()=>ne(e)}),B(D,{type:"delete",onClick:()=>ue()})]):B("div",l,[B(D,{type:"add",onClick:()=>ae(),title:"新增权限"}),B(D,{type:"edit",onClick:()=>oe(e)}),B(D,{type:"delete",onClick:()=>se()})])}}]),q=p([]),z=()=>{Object.assign(K,i({},F)),Object.assign(Q,i({},F)),H()},X=()=>{Object.assign(Q,i({},K)),H()},Z=()=>{H()},Y=e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);if(Array.isArray(e))return e.map(e=>Y(e));const t={};for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&(t[l]=Y(e[l]));return t},ee=e=>e.map(e=>{var t,l,r,a;const o=Y(e);if((null==(t=o.children)?void 0:t.length)&&(o.children=ee(o.children)),null==(r=null==(l=e.meta)?void 0:l.authList)?void 0:r.length){const t=e.meta.authList.map(t=>({path:`${e.path}_auth_${t.authMark}`,name:`${String(e.name)}_auth_${t.authMark}`,meta:{title:t.title,authMark:t.authMark,isAuthButton:!0,parentPath:e.path}}));o.children=(null==(a=o.children)?void 0:a.length)?[...o.children,...t]:t}return o}),te=e=>{var t,l,r,a;const o=[];for(const n of e){const e=(null==(t=Q.name)?void 0:t.toLowerCase().trim())||"",i=(null==(l=Q.route)?void 0:l.toLowerCase().trim())||"",s=O((null==(r=n.meta)?void 0:r.title)||"").toLowerCase(),u=(n.path||"").toLowerCase(),p=!e||s.includes(e),m=!i||u.includes(i);if(null==(a=n.children)?void 0:a.length){const e=te(n.children);if(e.length>0){const t=Y(n);t.children=e,o.push(t);continue}}p&&m&&o.push(Y(n))}return o},le=d(()=>{const e=te(q.value);return ee(e)}),re=()=>{o.value="menu",n.value=null,u.value=!0,a.value=!0},ae=()=>{o.value="menu",n.value=null,u.value=!1,a.value=!0},oe=e=>{o.value="menu",n.value=e,u.value=!0,a.value=!0},ne=e=>{var t,l;o.value="button",n.value={title:null==(t=e.meta)?void 0:t.title,authMark:null==(l=e.meta)?void 0:l.authMark},u.value=!1,a.value=!0},ie=e=>{H()},se=()=>s(null,null,function*(){try{yield S.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),L.success("删除成功"),H()}catch(e){"cancel"!==e&&L.error("删除失败")}}),ue=()=>s(null,null,function*(){try{yield S.confirm("确定要删除该权限吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),L.success("删除成功"),H()}catch(e){"cancel"!==e&&L.error("删除失败")}}),pe=()=>{l.value=!l.value,E(()=>{var e;if((null==(e=r.value)?void 0:e.elTableRef)&&le.value){const e=t=>{t.forEach(t=>{var a;(null==(a=t.children)?void 0:a.length)&&(r.value.elTableRef.toggleRowExpansion(t,l.value),e(t.children))})};e(le.value)}})};return(e,i)=>{const s=R,p=I,m=T,d=A,c=P,v=h("auth"),O=h("ripple");return f(),j("div",V,[y(s,{modelValue:b(K),"onUpdate:modelValue":i[0]||(i[0]=e=>g(K)?K.value=e:null),items:b(G),showExpand:!1,onReset:z,onSearch:X},null,8,["modelValue","items"]),y(c,{class:"art-table-card",shadow:"never"},{default:x(()=>[y(m,{showZebra:!1,loading:b(t),columns:b(N),"onUpdate:columns":i[1]||(i[1]=e=>g(N)?N.value=e:null),onRefresh:Z},{left:x(()=>[_((f(),k(p,{onClick:re},{default:x(()=>[...i[3]||(i[3]=[w(" 添加菜单 ",-1)])]),_:1})),[[v,"add"],[O]]),_((f(),k(p,{onClick:pe},{default:x(()=>[w(C(b(l)?"收起":"展开"),1)]),_:1})),[[O]])]),_:1},8,["loading","columns"]),y(d,{ref_key:"tableRef",ref:r,rowKey:"path",loading:b(t),columns:b(W),data:b(le),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),y($,{visible:b(a),"onUpdate:visible":i[2]||(i[2]=e=>g(a)?a.value=e:null),type:b(o),editData:b(n),lockType:b(u),onSubmit:ie},null,8,["visible","type","editData","lockType"])]),_:1})])}}}))));var K;export{F as default};
