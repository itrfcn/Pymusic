var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,n=(e,l)=>{for(var t in l||(l={}))s.call(l,t)&&r(e,t,l[t]);if(a)for(var t of a(l))o.call(l,t)&&r(e,t,l[t]);return e},u=(e,a)=>l(e,t(a));import{d as i,C as c,x as v,s as d,aG as p,a as f,o as m,aF as h,aA as x,n as g,e as y,f as b,p as w,z as j,u as k,dA as _,F as C,h as S,G as T,a3 as O,am as E,i as A,l as D,m as H,aC as L,a2 as P,az as V}from"./index-DxSWhjl1.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 */import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-VvwPD4Pm.js";import{E as M}from"./index-CRXlpzmM.js";import{E as $}from"./index-BdOifhfF.js";import{E as I}from"./index-CJAV6PHc.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-DpIcWAeA.js";import"./event-BwRzfsZt.js";import"./index-B4YNvkKg.js";import"./index-BdUhC8Rj.js";import"./aria-Dle50h-X.js";import"./index-DqeJCCY1.js";import"./vnode-D3WqlgwN.js";import"./index-B5405CIA.js";import"./use-dialog-DNz0WzI-.js";import"./refs-Cw5r5QN8.js";const G={class:"layout-search"},U={class:"h-4.5 flex-cc rounded border border-g-300 dark:!bg-g-200/50 !bg-box px-1.5 text-g-500"},z={class:"result w-full"},F=["onClick","onMouseenter"],q={class:"text-xs text-g-500"},Q={class:"mt-1.5 w-full"},B=["onClick","onMouseenter"],X=["onClick"],J={class:"dialog-footer box-border flex-c border-t-d pt-4.5 pb-1"},N={class:"flex-cc"},W={class:"mr-3.5 text-xs text-g-700"},Y={class:"flex-c"},Z={class:"mr-3.5 text-xs text-g-700"},ee={class:"flex-c"},le={class:"mr-3.5 text-xs text-g-700"},te=R(i(u(n({},{name:"ArtGlobalSearch"}),{__name:"index",setup(e){const l=c(),t=v(),{menuList:a}=d(p()),s=f(!1),o=f(""),r=f([]),{searchHistory:i}=d(t),R=f(null),te=f(0),ae=f(0),se=f(),oe=f(!1);m(()=>{h.on("openSearchDialog",be),document.addEventListener("keydown",re)}),x(()=>{document.removeEventListener("keydown",re)});const re=e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"k"===e.key.toLowerCase()&&(e.preventDefault(),s.value=!0,ne()),s.value&&("ArrowUp"===e.key?(e.preventDefault(),ce()):"ArrowDown"===e.key?(e.preventDefault(),ve()):"Enter"===e.key?(e.preventDefault(),fe()):"Escape"===e.key&&(e.preventDefault(),s.value=!1))},ne=()=>{setTimeout(()=>{var e;null==(e=R.value)||e.focus()},100)},ue=e=>{r.value=e?ie(a.value,e):[]},ie=(e,l)=>{const t=l.toLowerCase(),a=[],s=e=>{var l;if(null==(l=e.meta)?void 0:l.isHide)return;const o=L(e.meta.title).toLowerCase();e.children&&e.children.length>0?e.children.forEach(s):o.includes(t)&&e.path&&a.push(u(n({},e),{children:void 0}))};return e.forEach(s),a},ce=()=>{oe.value=!0,o.value?(te.value=(te.value-1+r.value.length)%r.value.length,de()):(ae.value=(ae.value-1+i.value.length)%i.value.length,pe()),setTimeout(()=>{oe.value=!1},100)},ve=()=>{oe.value=!0,o.value?(te.value=(te.value+1)%r.value.length,de()):(ae.value=(ae.value+1)%i.value.length,pe()),setTimeout(()=>{oe.value=!1},100)},de=()=>{g(()=>{if(!se.value||!r.value.length)return;const e=se.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".result .box");if(!l[te.value])return;const t=l[te.value],a=t.offsetHeight,s=e.scrollTop,o=e.clientHeight,n=t.offsetTop,u=n+a;n<s?se.value.setScrollTop(n):u>s+o&&se.value.setScrollTop(u-o)})},pe=()=>{g(()=>{if(!se.value||!i.value.length)return;const e=se.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".history-result .box");if(!l[ae.value])return;const t=l[ae.value],a=t.offsetHeight,s=e.scrollTop,o=e.clientHeight,r=t.offsetTop,n=r+a;r<s?se.value.setScrollTop(r):n>s+o&&se.value.setScrollTop(n-o)})},fe=()=>{o.value&&r.value.length?xe(r.value[te.value]):!o.value&&i.value.length&&xe(i.value[ae.value])},me=e=>te.value===e,he=()=>{te.value=0},xe=e=>{s.value=!1,ye(e),l.push(e.path),o.value="",r.value=[]},ge=()=>{Array.isArray(i.value)&&t.setSearchHistory(i.value)},ye=e=>{const l=i.value.findIndex(l=>l.path===e.path);-1!==l?i.value.splice(l,1):i.value.length>=10&&i.value.pop();const t=n({},e);delete t.children,delete t.meta.authList,i.value.unshift(t),ge()},be=()=>{s.value=!0,ne()},we=()=>{o.value="",r.value=[],te.value=0,ae.value=0};return(e,l)=>{const t=K,a=M,n=$,u=I;return b(),y("div",G,[w(u,{modelValue:k(s),"onUpdate:modelValue":l[1]||(l[1]=e=>C(s)?s.value=e:null),width:"600","show-close":!1,"lock-scroll":!1,"modal-class":"search-modal",onClose:we},{footer:j(()=>[S("div",J,[S("div",N,[w(t,{icon:"fluent:arrow-enter-left-20-filled",class:"keyboard"}),S("span",W,H(e.$t("search.selectKeydown")),1)]),S("div",Y,[w(t,{icon:"ri:arrow-up-wide-fill",class:"keyboard"}),w(t,{icon:"ri:arrow-down-wide-fill",class:"keyboard"}),S("span",Z,H(e.$t("search.switchKeydown")),1)]),S("div",ee,[l[2]||(l[2]=S("i",{class:"keyboard !w-8 flex-cc"},[S("p",{class:"text-[10px] font-medium"},"ESC")],-1)),S("span",le,H(e.$t("search.exitKeydown")),1)])])]),default:j(()=>[w(a,{modelValue:k(o),"onUpdate:modelValue":l[0]||(l[0]=e=>C(o)?o.value=e:null),modelModifiers:{trim:!0},placeholder:e.$t("search.placeholder"),onInput:ue,onBlur:he,ref_key:"searchInput",ref:R,"prefix-icon":k(_),class:"h-12"},{suffix:j(()=>[S("div",U,[w(t,{icon:"fluent:arrow-enter-left-20-filled"})])]),_:1},8,["modelValue","placeholder","prefix-icon"]),w(n,{class:"mt-5","max-height":"370px",ref_key:"searchResultScrollbar",ref:se,always:""},{default:j(()=>[T(S("div",z,[(b(!0),y(O,null,E(k(r),(e,l)=>(b(),y("div",{class:"box !mt-0 c-p text-base leading-none",key:l},[S("div",{class:A(["mt-2 h-12 flex-cb rounded-custom-sm bg-g-200/80 px-4 text-sm text-g-700",me(l)?"highlighted !bg-theme/70 !text-white":""]),onClick:l=>xe(e),onMouseenter:e=>(e=>{!oe.value&&o.value&&(te.value=e)})(l)},[D(H(k(L)(e.meta.title))+" ",1),T(w(t,{icon:"fluent:arrow-enter-left-20-filled"},null,512),[[P,me(l)]])],42,F)]))),128))],512),[[P,k(r).length]]),T(S("div",null,[S("p",q,H(e.$t("search.historyTitle")),1),S("div",Q,[(b(!0),y(O,null,E(k(i),(e,l)=>(b(),y("div",{class:A(["box mt-2 h-12 c-p flex-cb rounded-custom-sm bg-g-200/80 px-4 text-sm text-g-800",k(ae)===l?"highlighted !bg-theme/70 !text-white [&_.selected-icon]:!text-white":""]),key:l,onClick:l=>xe(e),onMouseenter:e=>(e=>{oe.value||o.value||(ae.value=e)})(l)},[D(H(k(L)(e.meta.title))+" ",1),S("div",{class:"size-5 selected-icon select-none rounded-full text-g-500 flex-cc c-p",onClick:V(e=>(e=>{i.value.splice(e,1),ge()})(l),["stop"])},[w(t,{icon:"ri:close-large-fill",class:"text-xs"})],8,X)],42,B))),128))])],512),[[P,!k(o)&&0===k(r).length&&k(i).length>0]])]),_:1},512)]),_:1},8,["modelValue"])])}}})),[["__scopeId","data-v-6afb5139"]]);export{te as default};
